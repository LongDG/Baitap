CREATE DATABASE QLDA
USE QLDA

CREATE TABLE NHANVIEN (
	MANV VARCHAR(10)NOT NULL,
	HONV NVARCHAR(50)NOT NULL,
	TENLOT NVARCHAR(50)NOT NULL,
	TEMNV NVARCHAR(50)NOT NULL,
	NGAYSINH DATE,
	PHAI NVARCHAR(50)NOT NULL,
	DAICHI NVARCHAR(50)NOT NULL,
	MANQL NVARCHAR(50),
	PHONG VARCHAR(10)NOT NULL,
	LUONG INT
)

CREATE TABLE DEAN (

	MADA VARCHAR(10)NOT NULL,
	TENDA NVARCHAR (50) NOT NULL,
	DIADIEMDA NVARCHAR(50) NOT NULL,
	PHONG VARCHAR(10) NOT NULL,
	NGAYBD_DK DATETIME,
	NGAYBD_KT DATETIME
)

CREATE TABLE PHONGBAN (

	MAPB VARCHAR(10)NOT NULL,
	TENPB NVARCHAR (50) NOT NULL,
	DIADIEM VARCHAR(10)NOT NULL,
	TRPHG INT, 
	NGAYNHANCHUC Datetime,
)

CREATE TABLE THANNHAN(
	MANV VARCHAR(10)NOT NULL,
	MATN VARCHAR NOT NULL,
	TENTN NVARCHAR(50) NOT NULL,
	PHAI NVARCHAR(10)NOT NULL,
	NGAYSINH DATETIME,
	QUANHE NVARCHAR(50)NOT NULL 

)


CREATE TABLE PHANCONG(
	MANV VARCHAR(10)NOT NULL,
	MADA VARCHAR(10)NOT NULL,
	THOIGIAN FLOAT,
)


--RANBUOC K9 VA KHOA PHU
ALTER TABLE NHANVIEN ADD CONSTRAINT PK_NHANVIEN PRIMARY KEY(MANV)
ALTER TABLE PHONGBAN ADD CONSTRAINT PK_PHONGBAN PRIMARY KEY(MAPB)
ALTER TABLE DEAN ADD CONSTRAINT PK_DEAN PRIMARY KEY(MADA)
ALTER TABLE PHANCONG ADD CONSTRAINT PK_PHANCONG PRIMARY KEY(MANV,MADA)
ALTER TABLE THANNHAN ADD CONSTRAINT PK_THANNHAN PRIMARY KEY(MANV,MATN)


SP_PKEYS THANNHAN
SP_PKEYS DEAN


ALTER TABLE THANNHAN ADD CONSTRAINT FK_THANNHAN_MANV FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)
ALTER TABLE PHANCONG ADD CONSTRAINT FK_PHANCONG_MANV FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)
ALTER TABLE PHANCONG ADD CONSTRAINT FK_PHANCONG_MADA FOREIGN KEY(MADA) REFERENCES DEAN(MADA)


--THEM DU LIEU VAO BANG
DELETE NHANVIEN 

INSERT INTO NHANVIEN VALUES ('001', N'VUONG' ,N'NGOC',N'QUYEN','1957-10-22', N'NU', N'HA NOI' ,NULL, 'QL', '3000000')
INSERT INTO NHANVIEN VALUES ('002', N'NGUYEN' ,N'THANH',N'TUNG','1955-9-1', N'NAM', N'TPHCM' ,'001', 'NC', '2500000')
INSERT INTO NHANVIEN VALUES ('003', N'LE' ,N'THI',N'NHAN','1960-12-18', N'NU', N'TPHCM' ,'001', 'DH', '2500000')
INSERT INTO NHANVIEN VALUES ('004', N'DINH' ,N'BA',N'TIEN','1968-1-9', N'NAM', N'DONG THAP' ,'002', 'NC', '2200000')
INSERT INTO NHANVIEN VALUES ('005', N'BUI' ,N'THUY',N'VU','1973-6-8', N'NU', N'TRA VINH' ,'003', 'DH', '2200000')
INSERT INTO NHANVIEN VALUES ('006', N'NGUYEN' ,N'MANH',N'HUNG','1981-8-30', N'NAM', N'DONG NAI' ,'004', 'NC', '2000000')
INSERT INTO NHANVIEN VALUES ('007', N'TRAN' ,N'HONG',N'VAN','1976-8-2', N'NU', N'VINH LONG' ,'004', 'NC', '1800000')


--DEAN

INSERT INTO DEAN VALUES ('TH001', 'TIN HOC HOA 1' ,'HA NOI','NC','2003-2-1','2004-2-1')
INSERT INTO DEAN VALUES ('TH002','TIN HOC HOA 2' ,'TPHCM','NV','2003-6-4','2004-2-4')
INSERT INTO DEAN VALUES ('DT001','DAO TAO 1', 'NHA TRANG','DH','2002-2-4','2006-2-4')
INSERT INTO DEAN VALUES ('DT002','DAO TAO 2', 'DA NANG','DH','2006-2-1','2006-12-12')

--THAN NHAN

INSERT INTO THANNHAN VALUES ('003','2',N'TRAN NGOC LINH','NU','1993-3-10','CON')
INSERT INTO THANNHAN VALUES ('003','3',N'TRAN MINH LONG','NAM','1957-10-10','VO CHONG')
INSERT INTO THANNHAN VALUES ('001','1',N'LE NHAT MINH','NAM','1955-4-27','VO CHONG')
INSERT INTO THANNHAN VALUES ('002','1',N'LE HOAI THUONG','NU','1960-12-5','VO CHONG')
INSERT INTO THANNHAN VALUES ('004','1',N'LE PHI PHUNG','NU','1960-12-24','VO CHONG')
INSERT INTO THANNHAN VALUES ('005','1',N'TRAN THU HONG','NU','1878-4-11','VO CHONG')
INSERT INTO THANNHAN VALUES ('005','2',N'NGUYEN MANH TAM','NAM','2003-3-12','CON')
--PHONG BAN

INSERT INTO PHONGBAN VALUES ('QL','QUAN LY','','001','2000-5-22')
INSERT INTO PHONGBAN VALUES ('DH','DIEU HANH','','003','2002-10-10')
INSERT INTO PHONGBAN VALUES ('NC','NGHIEN CUU','','002','2002-3-15')

--PHAN CONG
INSERT INTO PHANCONG VALUES('001','TH001','30')
INSERT INTO PHANCONG VALUES('001','TH002','12.5')
INSERT INTO PHANCONG VALUES('002','TH001','10')
INSERT INTO PHANCONG VALUES('002','TH002','10')
INSERT INTO PHANCONG VALUES('002','DT001','10')
INSERT INTO PHANCONG VALUES('002','DT002','10')
INSERT INTO PHANCONG VALUES('003','TH002','37.5')
INSERT INTO PHANCONG VALUES('004','DT001','22.5')
INSERT INTO PHANCONG VALUES('004','DT002','10')
INSERT INTO PHANCONG VALUES('006','DT001','30.5')
INSERT INTO PHANCONG VALUES('007','TH001','20')
INSERT INTO PHANCONG VALUES('007','TH002','10')

SELECT * 
FROM PHANCONG


--1
SELECT *
FROM NHANVIEN 
WHERE YEAR(NGAYSINH) BETWEEN 1965 AND 1970;
--2
SELECT HONV,TENLOT ,TEMNV , PHONG ,LUONG
FROM NHANVIEN
JOIN PHONGBAN ON NHANVIEN.PHONG = PHONGBAN.MAPB
WHERE
LUONG BETWEEN 2000000 AND 3000000
GROUP BY HONV, TENLOT,TEMNV , PHONG , LUONG
--3
SELECT HONV,TENLOT,TEMNV
FROM NHANVIEN
WHERE HONV = N'NGUYEN' OR TEMNV LIKE 'T%'
--4
SELECT *
FROM NHANVIEN
WHERE PHONG = 'NC' OR PHONG LIKE 'QL'

--5
SELECT *
FROM THANNHAN
WHERE NGAYSINH

--6

--7
SELECT TEMNV, DAICHI
FROM NHANVIEN N , PHONGBAN
WHERE 
PHONG = MAPB 
AND TENPB = 'NGHIEN CUU'
--8
SELECT NHANVIEN.MANV,TEMNV
FROM NHANVIEN 
INNER JOIN DEAN ON DEAN.PHONG = NHANVIEN.PHONG
INNER JOIN PHANCONG ON PHANCONG.MANV = NHANVIEN.MANV
INNER JOIN PHONGBAN ON PHONGBAN.MAPB = NHANVIEN.PHONG
WHERE TENPB = 'NGHIEN CUU'
AND TENDA LIKE 'TIN HOC HOA%'
AND THOIGIAN = '20'
GROUP BY  NHANVIEN.MANV,TEMNV

--9
SELECT HONV, TENLOT , TEMNV
FROM NHANVIEN , PHONGBAN , DEAN
WHERE
MANV  = TRPHG
AND PHONGBAN.MAPB = DEAN.PHONG
AND DIADIEMDA = 'HA NOI'
--10
SELECT HONV , TENLOT, TEMNV
FROM NHANVIEN
WHERE 
MANQL = '002'
--11
SELECT MIN(PHANCONG.THOIGIAN) AS TG_THAP, MAX(PHANCONG.THOIGIAN) AS TG_CAO, AVG(PHANCONG.THOIGIAN) AS TG_TB, SUM(PHANCONG.THOIGIAN) AS TONG_TG 
FROM PHANCONG

--12
SELECT AVG(PHANCONG.THOIGIAN) AS THOIGIANTRUNGBINHTRONGTUAN
FROM PHANCONG

--13
SELECT HONV , TENLOT , TEMNV
FROM NHANVIEN
WHERE NHANVIEN.LUONG > (
	SELECT AVG(NHANVIEN.LUONG)
	FROM NHANVIEN
	WHERE PHONG = 'NC'			
)

--14
SELECT COUNT(NHANVIEN.PHONG) AS SOLUONG
FROM NHANVIEN 
INNER JOIN PHONGBAN ON NHANVIEN.PHONG = PHONGBAN.MAPB

--15
SELECT COUNT(NHANVIEN.MANQL) AS SOLUONG
FROM NHANVIEN

--16
SELECT COUNT(DISTINCT NHANVIEN.MANQL) AS SOLUONG
FROM NHANVIEN

--17

SELECT PHONGBAN.TENPB ,COUNT(NHANVIEN.PHONG) AS SOLUONG
FROM NHANVIEN 
INNER JOIN PHONGBAN ON NHANVIEN.PHONG = PHONGBAN.MAPB
GROUP BY PHONGBAN.TENPB
--18
